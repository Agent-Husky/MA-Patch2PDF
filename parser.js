var filecontent,filename;function readFile(){const a=document.getElementById("testcontent"),[b]=document.querySelector("input[type=file]").files,c=new FileReader;c.addEventListener("load",()=>{"text/csv"===b.type?filecontent=parseCSV(c.result):"text/xml"===b.type&&(filecontent=parseXML(c.result)),filename=b.name},!1),b&&c.readAsText(b)}function parseCSV(a){var c={};return lines=a.replace(/\"/g,"").split("\n"),headers=lines[0].split(";"),layerlistpos=headers.indexOf("Layer"),headers[headers.indexOf("Fix ID")]="FixtureID",headers[headers.indexOf("Ch ID")]="ChannelID",layerindex=1,lines.shift(),lines=lines.filter(function(a){return""!=a}),lines.forEach(function(a){rowelements=a.split(";"),layer=rowelements.splice(layerlistpos,1),temp={},rowelements.forEach(function(c,a){temp[headers[a+1]]=c}),"undefined"==typeof c[layer]&&(c[layer]={},c[layer].index=layerindex++),"undefined"==typeof c[layer].data&&(c[layer].data=[]),c[layer].data.push(temp)}),c}function parseXML(a){var d={};parser=new DOMParser,xmlDoc=parser.parseFromString(a,"text/xml"),layers=xmlDoc.getElementsByTagName("Layer");for(let c of layers){"undefined"==typeof d[c]&&(d[c.attributes.name.value]={},d[c.attributes.name.value].data=[],d[c.attributes.name.value].index=+c.attributes.index.value),fixtures=c.getElementsByTagName("Fixture");for(let a of fixtures)subfixtures=a.getElementsByTagName("SubFixture"),patch=getPatch(subfixtures),null!==patch&&(temp={},temp.FixtureID=returnIfDefined(a.attributes.fixture_id),temp.ChannelID=returnIfDefined(a.attributes.channel_id,"."+(+subfixtures[0].attributes.index.value+1)),temp.Name=returnIfDefined(a.attributes.name),fixtype=a.getElementsByTagName("FixtureType")[0],temp.FixtureType=returnIfDefined(fixtype.attributes.name),temp.Patch=patch,temp.Position=getPosition(subfixtures),temp.Color=subfixtures[0].attributes.color.value,d[c.attributes.name.value].data.push(temp))}return d}function returnIfDefined(c,a=""){return"undefined"==typeof c?null:c.value+a}function getPatch(c){let a;if(1===c.length)a=+c[0].getElementsByTagName("Address")[0].textContent;else{let d=[];for(let a of c)d.push(+a.getElementsByTagName("Address")[0].textContent);a=Math.min(...d)}return 0===a?null:Math.ceil(a/512)+"."+("000"+a%512).slice(-3)}function getMiddle(a){return sum=a.reduce((b,c)=>b+c,0),+(sum/a.length).toFixed(2)}function getPosition(c){let a={};if(1===c.length)abspos=c[0].getElementsByTagName("AbsolutePosition")[0],"undefined"!=typeof abspos&&(abslocation=abspos.getElementsByTagName("Location")[0],a.x=abslocation.attributes.x.value,a.y=abslocation.attributes.y.value,a.z=abslocation.attributes.z.value);else{xarray=[],yarray=[],zarray=[],positions=[];for(let a of c)if(abspos=a.getElementsByTagName("AbsolutePosition")[0],"undefined"!=typeof abspos)absposattr=abspos.getElementsByTagName("Location")[0].attributes,xarray.push(+absposattr.x.value),yarray.push(+absposattr.y.value),zarray.push(+absposattr.z.value);else continue;a.x=getMiddle(xarray),a.y=getMiddle(yarray),a.z=getMiddle(zarray)}return"undefined"==typeof a.x&&(a.x=null),"undefined"==typeof a.y&&(a.y=null),"undefined"==typeof a.z&&(a.z=null),a}