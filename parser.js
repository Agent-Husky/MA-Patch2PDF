var filecontent,filename;function readFile(){const b=document.getElementById("testcontent"),[c]=document.querySelector("input[type=file]").files,d=new FileReader;d.addEventListener("load",()=>{"text/csv"===c.type?filecontent=parseCSV(d.result):"text/xml"===c.type&&(filecontent=parseXML(d.result)),filename=c.name},!1),c&&d.readAsText(c)}function parseCSV(b){var d={};return lines=b.replace(/\"/g,"").split("\n"),headers=lines[0].split(";"),layerlistpos=headers.indexOf("Layer"),headers[headers.indexOf("Fix ID")]="FixtureID",headers[headers.indexOf("Ch ID")]="ChannelID",layerindex=1,lines.shift(),lines=lines.filter(function(b){return""!=b}),lines.forEach(function(b){rowelements=b.split(";"),layer=rowelements.splice(layerlistpos,1),temp={},rowelements.forEach(function(a,b){temp[headers[b+1]]=a}),"undefined"==typeof d[layer]&&(d[layer]={},d[layer].index=layerindex++),"undefined"==typeof d[layer].data&&(d[layer].data=[]),d[layer].data.push(temp)}),d}function parseXML(b){var c={};parser=new DOMParser,xmlDoc=parser.parseFromString(b,"text/xml"),layers=xmlDoc.getElementsByTagName("Layer");for(let e of layers){"undefined"==typeof c[e]&&(c[e.attributes.name.value]={},c[e.attributes.name.value].data=[],c[e.attributes.name.value].index=+e.attributes.index.value),fixtures=e.getElementsByTagName("Fixture");for(let b of fixtures)subfixtures=b.getElementsByTagName("SubFixture"),patch=getPatch(subfixtures),null!==patch&&(temp={},temp.FixtureID=returnIfDefined(b.attributes.fixture_id),temp.ChannelID=returnIfDefined(b.attributes.channel_id,"."+(+subfixtures[0].attributes.index.value+1)),temp.Name=returnIfDefined(b.attributes.name),fixtype=b.getElementsByTagName("FixtureType")[0],temp.FixtureType=returnIfDefined(fixtype.attributes.name),temp.Patch=patch,temp.Position=getPosition(subfixtures),temp.Color=subfixtures[0].attributes.color.value,c[e.attributes.name.value].data.push(temp))}return c}function returnIfDefined(a,b=""){return"undefined"==typeof a?null:a.value+b}function getPatch(a){let b;if(1===a.length)b=+a[0].getElementsByTagName("Address")[0].textContent;else{let e=[];for(let b of a)e.push(+b.getElementsByTagName("Address")[0].textContent);b=Math.min(...e)}return 0===b?null:Math.ceil(b/512)+"."+("000"+b%512).slice(-3)}function getMiddle(b){return sum=b.reduce((c,a)=>c+a,0),+(sum/b.length).toFixed(2)}function getPosition(a){let b={};if(1===a.length)abspos=a[0].getElementsByTagName("AbsolutePosition")[0],"undefined"!=typeof abspos&&(abslocation=abspos.getElementsByTagName("Location")[0],b.x=abslocation.attributes.x.value,b.y=abslocation.attributes.y.value,b.z=abslocation.attributes.z.value);else{xarray=[],yarray=[],zarray=[],positions=[];for(let b of a)if(abspos=b.getElementsByTagName("AbsolutePosition")[0],"undefined"!=typeof abspos)absposattr=abspos.getElementsByTagName("Location")[0].attributes,xarray.push(+absposattr.x.value),yarray.push(+absposattr.y.value),zarray.push(+absposattr.z.value);else continue;b.x=getMiddle(xarray),b.y=getMiddle(yarray),b.z=getMiddle(zarray)}return"undefined"==typeof b.x&&(b.x=null),"undefined"==typeof b.y&&(b.y=null),"undefined"==typeof b.z&&(b.z=null),b}